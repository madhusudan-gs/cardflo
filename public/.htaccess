# FINAL NO-FAIL CONFIG FOR CARDFLO
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # 1. MIME TYPES & ENCODING
  AddType text/css .css
  AddType application/javascript .js
  AddType image/svg+xml .svg
  AddType application/json .json
  
  # 2. PREVENT SPA FALLBACK FOR STATIC ASSETS
  # If a file in _next or a known asset type is missing, return a REAL 404.
  # This prevents "Resource interpreted as Stylesheet but transferred with MIME type text/html" errors.
  RewriteCond %{REQUEST_URI} ^/_next/ [OR]
  RewriteCond %{REQUEST_URI} \.(css|js|png|jpg|jpeg|gif|ico|svg|json|webp|woff|woff2|ttf|otf)$
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteRule . - [R=404,L]

  # 3. CLEAN URLS – Try appending .html for static pages (e.g. /thankyou → /thankyou.html)
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME}.html -f
  RewriteRule ^(.*)$ $1.html [L]

  # 4. SPA ROUTING FALLBACK
  # Support single-page application navigation (everything falls back to index)
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /index.html [L]
</IfModule>

# 4. CACHE CONTROL
<IfModule mod_expires.c>
  ExpiresActive On
  
  # DO NOT CACHE HTML (Ensures users always see the latest version)
  ExpiresByType text/html "access plus 0 seconds"
  
  # CACHE HASHED ASSETS PERMANENTLY (Since hashes change on every update)
  ExpiresByType application/javascript "access plus 1 year"
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType image/x-icon "access plus 1 month"
</IfModule>

# 5. SECURITY & MIME FIXES
<IfModule mod_headers.c>
  Header set X-Content-Type-Options "nosniff"
</IfModule>
